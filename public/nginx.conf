# Proxy sitemap requests to Supabase edge functions
location = /sitemap_index.xml {
    proxy_pass https://yknmcddrfkggphrktivd.supabase.co/functions/v1/sitemap-index;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

location = /sitemap_tournaments.xml {
    proxy_pass https://yknmcddrfkggphrktivd.supabase.co/functions/v1/sitemap-tournaments;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

location = /blog/sitemap.xml {
    proxy_pass https://yknmcddrfkggphrktivd.supabase.co/functions/v1/blog-sitemap;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

location = /blog/feed.xml {
    proxy_pass https://yknmcddrfkggphrktivd.supabase.co/functions/v1/blog-feed;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

# Try files before falling back to index.html for client-side routing
try_files $uri $uri/ /index.html;

# Cache static assets
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# Special handling for alert routes
location /alerts/ {
    add_header X-Robots-Tag "noindex, nofollow";
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    try_files $uri $uri/ /index.html;
}